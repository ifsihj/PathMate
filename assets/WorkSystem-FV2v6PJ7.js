import{_ as X,j as ce,c as r,o as i,a as t,m as M,n as z,t as $,x as F,h as E,i as Me,r as h,y as Ye,b as Ce,z as te,F as V,f as P,A as Ve,B as Pe,C as be,v as b,d as c,D as $e,w as f,T as Je,e as U,p as R}from"./index-kcQoswnZ.js";import{g as Re,s as Xe}from"./chatApi-CxDZByMz.js";const qe={class:"task-header"},We={class:"task-title"},Ge={key:0,class:"task-description"},Ke={class:"task-footer"},Qe={class:"task-meta"},Ze={key:0,class:"task-assignee"},_e={__name:"TaskCard",props:{task:{type:Object,required:!0}},emits:["edit","delete"],setup(n){const u=n,g=ce(()=>{if(!u.task.deadline)return!1;const d=new Date(u.task.deadline),s=new Date;return u.task.status!=="done"&&d<s}),v=d=>{d.dataTransfer.setData("taskId",u.task.id)},D=d=>{const s=new Date(d),a=Math.floor((s-new Date)/(1e3*60*60*24));if(a<0)return`已逾期 ${Math.abs(a)} 天`;if(a===0)return"今天";if(a===1)return"明天";if(a<=7)return`${a} 天后`;{const S=(s.getMonth()+1).toString().padStart(2,"0"),k=s.getDate().toString().padStart(2,"0");return`${S}-${k}`}};return(d,s)=>(i(),r("div",{class:z(["task-card",[`priority-${n.task.priority}`,{overdue:g.value}]]),draggable:"true",onDragstart:v,onClick:s[1]||(s[1]=y=>d.$emit("edit",n.task))},[t("div",qe,[t("div",{class:z(["task-priority-dot",`priority-${n.task.priority}`])},null,2),t("h4",We,$(n.task.title),1),t("button",{class:"delete-task-btn",onClick:s[0]||(s[0]=F(y=>d.$emit("delete",n.task.id),["stop"])),title:"删除"},[...s[2]||(s[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("polyline",{points:"3 6 5 6 21 6"}),t("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])])]),n.task.description?(i(),r("p",Ge,$(n.task.description),1)):M("",!0),t("div",Ke,[t("div",Qe,[n.task.assignee?(i(),r("span",Ze,[s[3]||(s[3]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),t("circle",{cx:"12",cy:"7",r:"4"})],-1)),E(" "+$(n.task.assignee),1)])):M("",!0),n.task.deadline?(i(),r("span",{key:1,class:z(["task-deadline",{overdue:g.value}])},[s[4]||(s[4]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("polyline",{points:"12 6 12 12 16 14"})],-1)),E(" "+$(D(n.task.deadline)),1)],2)):M("",!0)])])],34))}},ve=X(_e,[["__scopeId","data-v-21d387f2"]]),et={class:"file-item"},tt={class:"file-icon"},nt={key:0,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},ot={key:1,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},lt={class:"file-info"},st=["title"],it={class:"file-meta"},at={key:0},rt={key:1},dt={class:"file-actions"},ut={__name:"FileItem",props:{file:{type:Object,required:!0}},emits:["download","delete"],setup(n){const u=n,g=ce(()=>u.file.type?.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|svg)$/i.test(u.file.name)),v=d=>{if(!d)return"0 B";const s=1024,y=["B","KB","MB","GB"],a=Math.floor(Math.log(d)/Math.log(s));return Math.round(d/Math.pow(s,a)*100)/100+" "+y[a]},D=d=>{const s=new Date(d),a=new Date-s,S=Math.floor(a/864e5);return S===0?"今天":S===1?"昨天":S<7?`${S}天前`:s.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})};return(d,s)=>(i(),r("div",et,[t("div",tt,[g.value?(i(),r("svg",nt,[...s[2]||(s[2]=[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"},null,-1),t("circle",{cx:"8.5",cy:"8.5",r:"1.5"},null,-1),t("polyline",{points:"21 15 16 10 5 21"},null,-1)])])):(i(),r("svg",ot,[...s[3]||(s[3]=[Me('<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" data-v-51706f7c></path><polyline points="14 2 14 8 20 8" data-v-51706f7c></polyline><line x1="16" y1="13" x2="8" y2="13" data-v-51706f7c></line><line x1="16" y1="17" x2="8" y2="17" data-v-51706f7c></line><polyline points="10 9 9 9 8 9" data-v-51706f7c></polyline>',5)])]))]),t("div",lt,[t("h4",{class:"file-name",title:n.file.name},$(n.file.name),9,st),t("p",it,[t("span",null,$(v(n.file.size)),1),s[4]||(s[4]=t("span",null,"·",-1)),t("span",null,$(D(n.file.uploadedAt)),1),n.file.uploader?(i(),r("span",at,"·")):M("",!0),n.file.uploader?(i(),r("span",rt,$(n.file.uploader),1)):M("",!0)])]),t("div",dt,[t("button",{class:"action-btn",onClick:s[0]||(s[0]=y=>d.$emit("download",n.file)),title:"下载"},[...s[5]||(s[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])]),t("button",{class:"action-btn delete",onClick:s[1]||(s[1]=y=>d.$emit("delete",n.file.id)),title:"删除"},[...s[6]||(s[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("polyline",{points:"3 6 5 6 21 6"}),t("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])])])]))}},vt=X(ut,[["__scopeId","data-v-51706f7c"]]),ct={class:"doc-info"},mt={class:"doc-title"},pt={key:0,class:"doc-description"},wt={class:"doc-meta"},gt={key:0},ht={key:1},ft={__name:"DocumentItem",props:{document:{type:Object,required:!0}},emits:["open","delete"],setup(n){const u=g=>{const v=new Date(g),d=new Date-v,s=Math.floor(d/864e5);return s===0?"今天":s===1?"昨天":s<7?`${s}天前`:v.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})};return(g,v)=>(i(),r("div",{class:"document-item",onClick:v[1]||(v[1]=D=>g.$emit("open",n.document))},[v[3]||(v[3]=Me('<div class="doc-icon" data-v-7bc38f10><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-7bc38f10><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" data-v-7bc38f10></path><polyline points="14 2 14 8 20 8" data-v-7bc38f10></polyline><line x1="16" y1="13" x2="8" y2="13" data-v-7bc38f10></line><line x1="16" y1="17" x2="8" y2="17" data-v-7bc38f10></line><polyline points="10 9 9 9 8 9" data-v-7bc38f10></polyline></svg></div>',1)),t("div",ct,[t("h4",mt,$(n.document.title),1),n.document.description?(i(),r("p",pt,$(n.document.description),1)):M("",!0),t("p",wt,[t("span",null,$(u(n.document.createdAt)),1),n.document.lastEditor?(i(),r("span",gt,"·")):M("",!0),n.document.lastEditor?(i(),r("span",ht,"最后编辑: "+$(n.document.lastEditor),1)):M("",!0)])]),t("button",{class:"delete-doc-btn",onClick:v[0]||(v[0]=F(D=>g.$emit("delete",n.document.id),["stop"])),title:"删除"},[...v[2]||(v[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("polyline",{points:"3 6 5 6 21 6"}),t("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])])]))}},kt=X(ft,[["__scopeId","data-v-7bc38f10"]]),yt={class:"group-chat"},xt={key:0,class:"message-avatar"},Dt=["src","alt"],bt={key:1,class:"avatar-placeholder"},$t={class:"message-content"},Mt={key:0,class:"message-sender"},Ct={class:"message-bubble"},St={class:"message-text"},Lt={class:"message-time"},Bt={key:0,class:"empty-messages"},It={class:"chat-input-container"},Et={class:"input-wrapper"},jt=["onKeydown"],Tt=["disabled"],Ft={__name:"GroupChat",props:{chatId:{type:String,required:!0}},setup(n){const u=n,g=h([]),v=h(""),D=h(null),d=h(null),s=async()=>{try{const k=await Re(u.chatId);g.value=k,await te(),a()}catch(k){console.error("Failed to load messages:",k)}},y=async()=>{if(!v.value.trim())return;const k=v.value.trim();v.value="";try{const p=await Xe(u.chatId,k);g.value.push(p),await te(),a()}catch(p){console.error("Failed to send message:",p),b.error("发送消息失败"),v.value=k}},a=()=>{D.value&&(D.value.scrollTop=D.value.scrollHeight)},S=k=>{const p=new Date(k),m=p.getHours().toString().padStart(2,"0"),j=p.getMinutes().toString().padStart(2,"0");return`${m}:${j}`};return Ye(g,()=>{te(()=>{a()})},{deep:!0}),Ce(()=>{s(),te(()=>{d.value&&d.value.focus()})}),(k,p)=>(i(),r("div",yt,[t("div",{class:"chat-messages",ref_key:"messagesContainer",ref:D},[(i(!0),r(V,null,P(g.value,m=>(i(),r("div",{key:m.id,class:z(["message-item",{"message-sent":m.senderId==="current-user"}])},[m.senderId!=="current-user"?(i(),r("div",xt,[m.senderAvatar?(i(),r("img",{key:0,src:m.senderAvatar,alt:m.senderName},null,8,Dt)):(i(),r("div",bt,$(m.senderName?.charAt(0)||"U"),1))])):M("",!0),t("div",$t,[m.senderId!=="current-user"?(i(),r("div",Mt,$(m.senderName),1)):M("",!0),t("div",Ct,[t("p",St,$(m.content),1),t("span",Lt,$(S(m.timestamp)),1)])])],2))),128)),g.value.length===0?(i(),r("div",Bt,[...p[2]||(p[2]=[t("p",null,"还没有消息，开始聊天吧！",-1)])])):M("",!0)],512),t("div",It,[t("div",Et,[Ve(t("textarea",{"onUpdate:modelValue":p[0]||(p[0]=m=>v.value=m),onKeydown:[be(F(y,["exact","prevent"]),["enter"]),p[1]||(p[1]=be(F(m=>v.value+=`
`,["shift","exact"]),["enter"]))],placeholder:"输入消息...",class:"message-input",rows:"1",ref_key:"messageInput",ref:d},null,40,jt),[[Pe,v.value]]),t("button",{class:"send-btn",onClick:y,disabled:!v.value.trim()},[...p[3]||(p[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),t("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})],-1)])],8,Tt)])])]))}},zt=X(Ft,[["__scopeId","data-v-d8999130"]]),me=n=>new Promise(u=>setTimeout(u,n)),Ot=async()=>{await me(200);const n=localStorage.getItem("work-system-ddl");return n?JSON.parse(n):[]},Ht=async(n,u)=>{await me(200);const g=localStorage.getItem("work-system-ddl");if(g){const v=JSON.parse(g),D=v.findIndex(d=>d.id===n);D!==-1&&(v[D]={...v[D],...u},localStorage.setItem("work-system-ddl",JSON.stringify(v)))}return{success:!0}},At=async n=>(await me(200),{success:!0}),Ut={class:"ddl-header"},Nt={class:"ddl-title"},Yt={key:0,xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Vt={key:1,xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Pt={class:"ddl-deadline"},Jt={key:0,class:"ddl-description"},Rt={class:"ddl-footer"},Xt={__name:"DDLItem",props:{ddl:{type:Object,required:!0}},emits:["edit","delete"],setup(n,{emit:u}){const g=n,v=ce(()=>g.ddl.completed?!1:new Date(g.ddl.deadline)<new Date),D=y=>{const a=new Date(y),k=Math.floor((a-new Date)/(1e3*60*60*24)),p=m=>{const j=m.getHours().toString().padStart(2,"0"),O=m.getMinutes().toString().padStart(2,"0");return`${j}:${O}`};if(k<0)return`已逾期 ${Math.abs(k)} 天`;if(k===0)return`今天 ${p(a)}`;if(k===1)return`明天 ${p(a)}`;if(k<=7){const m=(a.getMonth()+1).toString().padStart(2,"0"),j=a.getDate().toString().padStart(2,"0");return`${k} 天后 ${m}-${j} ${p(a)}`}else{const m=a.getFullYear(),j=(a.getMonth()+1).toString().padStart(2,"0"),O=a.getDate().toString().padStart(2,"0");return`${m}-${j}-${O} ${p(a)}`}},d=y=>({low:"低",medium:"中",high:"高",urgent:"紧急"})[y]||"中",s=async()=>{try{await Ht(g.ddl.id,{completed:!g.ddl.completed}),g.ddl.completed=!g.ddl.completed,b.success(g.ddl.completed?"已标记为完成":"已取消完成")}catch(y){console.error("Failed to update DDL:",y),b.error("操作失败")}};return(y,a)=>(i(),r("div",{class:z(["ddl-item",{overdue:v.value,urgent:n.ddl.priority==="urgent",completed:n.ddl.completed}]),onClick:a[1]||(a[1]=S=>y.$emit("edit",n.ddl))},[t("div",Ut,[t("div",{class:z(["ddl-priority",`priority-${n.ddl.priority}`])},null,2),t("h4",Nt,$(n.ddl.title),1),t("button",{class:z(["complete-btn",{completed:n.ddl.completed}]),onClick:F(s,["stop"]),title:"标记完成"},[n.ddl.completed?(i(),r("svg",Yt,[...a[2]||(a[2]=[t("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):(i(),r("svg",Vt,[...a[3]||(a[3]=[t("circle",{cx:"12",cy:"12",r:"10"},null,-1)])]))],2)]),t("div",Pt,[a[4]||(a[4]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("polyline",{points:"12 6 12 12 16 14"})],-1)),t("span",{class:z({"overdue-text":v.value})},$(D(n.ddl.deadline)),3)]),n.ddl.description?(i(),r("p",Jt,$(n.ddl.description),1)):M("",!0),t("div",Rt,[t("span",{class:z(["ddl-priority-label",`priority-${n.ddl.priority}`])},$(d(n.ddl.priority)),3),t("button",{class:"delete-ddl-btn",onClick:a[0]||(a[0]=F(S=>y.$emit("delete",n.ddl.id),["stop"])),title:"删除"},[...a[5]||(a[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("polyline",{points:"3 6 5 6 21 6"}),t("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])])])],2))}},qt=X(Xt,[["__scopeId","data-v-a4e0101f"]]),pe=n=>new Promise(u=>setTimeout(u,n)),Wt=async n=>(await pe(500),{id:Date.now(),name:n.name,size:n.size,type:n.type,url:URL.createObjectURL(n),uploadedAt:Date.now(),uploader:"当前用户"}),Gt=async()=>{await pe(200);const n=localStorage.getItem("work-system-files");return n?JSON.parse(n):[]},Kt=async n=>(await pe(200),{success:!0}),we=n=>new Promise(u=>setTimeout(u,n)),Qt=async()=>{await we(200);const n=localStorage.getItem("work-system-documents");return n?JSON.parse(n):[]},Zt=async(n,u)=>(await we(300),{id:Date.now(),title:n,description:u||"",createdAt:Date.now(),lastEditor:"当前用户",lastEditedAt:Date.now()}),_t=async n=>(await we(200),{success:!0}),en={class:"work-system"},tn={class:"work-content"},nn={class:"kanban-board"},on={class:"kanban-column"},ln={class:"column-header"},sn={class:"task-count"},an={class:"kanban-column"},rn={class:"column-header"},dn={class:"task-count"},un={class:"kanban-column"},vn={class:"column-header"},cn={class:"task-count"},mn={class:"panel-tabs"},pn={key:0,class:"panel-content"},wn={class:"file-list"},gn={key:0,class:"empty-state"},hn={key:1,class:"panel-content"},fn={class:"panel-header"},kn={class:"document-list"},yn={key:0,class:"empty-state"},xn={key:2,class:"panel-content chat-panel"},Dn={key:3,class:"panel-content"},bn={class:"panel-header"},$n={class:"ddl-list"},Mn={key:0,class:"empty-state"},Cn={__name:"WorkSystem",setup(n){const u=h("files"),g=h("group-chat-1"),v=h(!1),D=h({bottom:32,right:32}),d=h({bottom:32,right:32}),s=h({width:420,height:600}),y=h(!1),a=h(!1),S=h(null),k=h({x:0,y:0}),p=h({bottom:0,right:0,width:0,height:0}),m=h([]),j=h(!1),O=h(null),x=h({title:"",description:"",assignee:"",priority:"medium",deadline:null,status:"todo"}),N=h([]),ge=h(null),Y=h([]),G=h(!1),A=h({title:"",description:""}),H=h([]),q=h(!1),K=h(null),C=h({title:"",deadline:null,description:"",priority:"medium"}),J=o=>m.value.filter(e=>e.status===o),ne=o=>{x.value.status=o,O.value=null,j.value=!0},oe=o=>{O.value=o,x.value={title:o.title,description:o.description||"",assignee:o.assignee||"",priority:o.priority||"medium",deadline:o.deadline||null,status:o.status},j.value=!0},Se=()=>{if(!x.value.title.trim()){b.warning("请输入任务标题");return}if(O.value){const o=m.value.findIndex(e=>e.id===O.value.id);o!==-1&&(m.value[o]={...m.value[o],...x.value,deadline:x.value.deadline?typeof x.value.deadline=="number"?x.value.deadline:x.value.deadline.valueOf():null}),b.success("任务已更新")}else{const o={id:Date.now(),...x.value,deadline:x.value.deadline?typeof x.value.deadline=="number"?x.value.deadline:x.value.deadline.valueOf():null,createdAt:Date.now()};m.value.push(o),b.success("任务已创建")}Q(),he(),j.value=!1},le=o=>{m.value=m.value.filter(e=>e.id!==o),Q(),b.success("任务已删除")},se=(o,e)=>{const L=parseInt(o.dataTransfer.getData("taskId")),w=m.value.find(I=>I.id===L);w&&(w.status=e,Q())},he=()=>{x.value={title:"",description:"",assignee:"",priority:"medium",deadline:null,status:"todo"},O.value=null},Le=()=>{ge.value?.click()},Be=async o=>{const e=Array.from(o.target.files);for(const L of e)try{const w=await Wt(L);N.value.unshift(w),b.success(`${L.name} 上传成功`)}catch(w){console.error("Failed to upload file:",w),b.error(`${L.name} 上传失败`)}o.target.value="",ye()},Ie=o=>{const e=document.createElement("a");o.url?(e.href=o.url,e.download=o.name,e.click()):b.info("文件下载功能开发中...")},Ee=async o=>{try{await Kt(o),N.value=N.value.filter(e=>e.id!==o),ye(),b.success("文件已删除")}catch(e){console.error("Failed to delete file:",e),b.error("删除文件失败")}},je=async()=>{if(!A.value.title.trim()){b.warning("请输入文档标题");return}try{const o=await Zt(A.value.title,A.value.description);Y.value.unshift(o),xe(),b.success("文档已创建"),ke(),G.value=!1}catch(o){console.error("Failed to create document:",o),b.error("创建文档失败")}},Te=o=>{b.info(`打开文档: ${o.title}`)},Fe=async o=>{try{await _t(o),Y.value=Y.value.filter(e=>e.id!==o),xe(),b.success("文档已删除")}catch(e){console.error("Failed to delete document:",e),b.error("删除文档失败")}},ze=()=>{if(!C.value.title.trim()){b.warning("请输入DDL标题");return}if(!C.value.deadline){b.warning("请选择截止时间");return}if(K.value){const o=H.value.findIndex(e=>e.id===K.value.id);o!==-1&&(H.value[o]={...H.value[o],...C.value,deadline:C.value.deadline.valueOf()}),b.success("DDL已更新")}else{const o={id:Date.now(),...C.value,deadline:C.value.deadline?typeof C.value.deadline=="number"?C.value.deadline:C.value.deadline.valueOf():null,createdAt:Date.now(),completed:!1};H.value.unshift(o),b.success("DDL已添加")}De(),fe(),q.value=!1},Oe=o=>{K.value=o,C.value={title:o.title,deadline:o.deadline,description:o.description||"",priority:o.priority||"medium"},q.value=!0},He=async o=>{try{await At(o),H.value=H.value.filter(e=>e.id!==o),De(),b.success("DDL已删除")}catch(e){console.error("Failed to delete DDL:",e),b.error("删除DDL失败")}},fe=()=>{C.value={title:"",deadline:null,description:"",priority:"medium"},K.value=null},ke=()=>{A.value={title:"",description:""}},Q=()=>{localStorage.setItem("work-system-tasks",JSON.stringify(m.value))},ye=()=>{localStorage.setItem("work-system-files",JSON.stringify(N.value))},xe=()=>{localStorage.setItem("work-system-documents",JSON.stringify(Y.value))},De=()=>{localStorage.setItem("work-system-ddl",JSON.stringify(H.value))},Ae=async()=>{const o=localStorage.getItem("work-system-tasks");if(o)try{m.value=JSON.parse(o)}catch(e){console.error("Failed to load tasks:",e)}else m.value=[{id:1,title:"Path概括",description:"完成Path项目的整体概括",assignee:"小明",priority:"high",status:"todo",deadline:Date.now()+864e5*3,createdAt:Date.now()-864e5*2},{id:2,title:"Mate管理",description:"完善团队成员管理功能",assignee:"小红",priority:"medium",status:"todo",deadline:Date.now()+864e5*5,createdAt:Date.now()-864e5},{id:3,title:"数据库设计",description:"设计项目数据库结构",assignee:"小李",priority:"high",status:"in-progress",deadline:Date.now()+864e5*2,createdAt:Date.now()-864e5*3},{id:4,title:"API接口开发",description:"开发后端API接口",assignee:"小张",priority:"medium",status:"in-progress",deadline:Date.now()+864e5*7,createdAt:Date.now()-864e5*4},{id:5,title:"需求分析",description:"完成项目需求分析文档",assignee:"小王",priority:"low",status:"done",deadline:Date.now()-864e5,createdAt:Date.now()-864e5*10}],Q();try{N.value=await Gt()}catch(e){console.error("Failed to load files:",e)}try{Y.value=await Qt()}catch(e){console.error("Failed to load documents:",e)}try{H.value=await Ot()}catch(e){console.error("Failed to load DDL list:",e)}},Ue=o=>{let e=!1;const L=o.clientX,w=o.clientY,I=T=>{const ee=Math.abs(T.clientX-L),W=Math.abs(T.clientY-w);(ee>5||W>5)&&(e=!0,y.value=!0,S.value="toggleBtn",k.value={x:L,y:w},p.value={bottom:D.value.bottom,right:D.value.right},document.addEventListener("mousemove",Z),document.addEventListener("mouseup",_),document.removeEventListener("mousemove",I))};document.addEventListener("mousemove",I);const B=()=>{document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",B),e||(v.value=!0)};document.addEventListener("mouseup",B)},Ne=o=>{o.target.closest(".panel-close-btn")||(y.value=!0,S.value="panel",k.value={x:o.clientX,y:o.clientY},p.value={bottom:d.value.bottom,right:d.value.right},document.addEventListener("mousemove",Z),document.addEventListener("mouseup",_),o.preventDefault())},ie=h(null),ae=(o,e)=>{a.value=!0,S.value="resize",ie.value=o,k.value={x:e.clientX,y:e.clientY},p.value={bottom:d.value.bottom,right:d.value.right,width:s.value.width,height:s.value.height},document.addEventListener("mousemove",re),document.addEventListener("mouseup",de),e.preventDefault(),e.stopPropagation()},Z=o=>{if(!y.value)return;const e=o.clientX-k.value.x,L=k.value.y-o.clientY;if(S.value==="toggleBtn"){const w=p.value.right-e,I=p.value.bottom+L,B=window.innerWidth-56,T=window.innerHeight-56;D.value.right=Math.max(0,Math.min(w,B)),D.value.bottom=Math.max(0,Math.min(I,T))}else if(S.value==="panel"){const w=p.value.right-e,I=p.value.bottom+L,B=window.innerWidth-s.value.width,T=window.innerHeight-s.value.height;d.value.right=Math.max(0,Math.min(w,B)),d.value.bottom=Math.max(0,Math.min(I,T))}},re=o=>{if(!a.value)return;const e=o.clientX-k.value.x,L=k.value.y-o.clientY,w=ie.value;if(w==="right"||w==="corner"){const I=p.value.width+e,B=300,T=window.innerWidth-d.value.right-32;s.value.width=Math.max(B,Math.min(I,T))}if(w==="bottom"||w==="corner"){const I=p.value.height+L,B=400,T=window.innerHeight-d.value.bottom-32;s.value.height=Math.max(B,Math.min(I,T))}},_=()=>{y.value=!1,S.value=null,document.removeEventListener("mousemove",Z),document.removeEventListener("mouseup",_)},de=()=>{a.value=!1,S.value=null,ie.value=null,document.removeEventListener("mousemove",re),document.removeEventListener("mouseup",de)};return Ce(()=>(Ae(),()=>{document.removeEventListener("mousemove",Z),document.removeEventListener("mouseup",_),document.removeEventListener("mousemove",re),document.removeEventListener("mouseup",de)})),(o,e)=>{const L=U("a-input"),w=U("a-form-item"),I=U("a-textarea"),B=U("a-select-option"),T=U("a-select"),ee=U("a-date-picker"),W=U("a-form"),ue=U("a-modal");return i(),r("div",en,[e[63]||(e[63]=t("div",{class:"page-header"},[t("h1",{class:"page-title"},"工作系统")],-1)),t("div",tn,[t("div",nn,[t("div",on,[t("div",ln,[e[33]||(e[33]=t("h3",{class:"column-title"},"To do",-1)),t("span",sn,$(J("todo").length),1)]),t("div",{class:"task-list",onDrop:e[1]||(e[1]=l=>se(l,"todo")),onDragover:e[2]||(e[2]=F(()=>{},["prevent"]))},[(i(!0),r(V,null,P(J("todo"),l=>(i(),R(ve,{key:l.id,task:l,onEdit:oe,onDelete:le},null,8,["task"]))),128)),t("button",{class:"add-task-btn",onClick:e[0]||(e[0]=l=>ne("todo"))},[...e[34]||(e[34]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),E(" 添加任务 ",-1)])])],32)]),t("div",an,[t("div",rn,[e[35]||(e[35]=t("h3",{class:"column-title"},"In progress",-1)),t("span",dn,$(J("in-progress").length),1)]),t("div",{class:"task-list",onDrop:e[4]||(e[4]=l=>se(l,"in-progress")),onDragover:e[5]||(e[5]=F(()=>{},["prevent"]))},[(i(!0),r(V,null,P(J("in-progress"),l=>(i(),R(ve,{key:l.id,task:l,onEdit:oe,onDelete:le},null,8,["task"]))),128)),t("button",{class:"add-task-btn",onClick:e[3]||(e[3]=l=>ne("in-progress"))},[...e[36]||(e[36]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),E(" 添加任务 ",-1)])])],32)]),t("div",un,[t("div",vn,[e[37]||(e[37]=t("h3",{class:"column-title"},"Done",-1)),t("span",cn,$(J("done").length),1)]),t("div",{class:"task-list",onDrop:e[7]||(e[7]=l=>se(l,"done")),onDragover:e[8]||(e[8]=F(()=>{},["prevent"]))},[(i(!0),r(V,null,P(J("done"),l=>(i(),R(ve,{key:l.id,task:l,onEdit:oe,onDelete:le},null,8,["task"]))),128)),t("button",{class:"add-task-btn",onClick:e[6]||(e[6]=l=>ne("done"))},[...e[38]||(e[38]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),E(" 添加任务 ",-1)])])],32)])]),v.value?M("",!0):(i(),r("button",{key:0,class:"panel-toggle-btn",style:$e({bottom:D.value.bottom+"px",right:D.value.right+"px"}),onMousedown:F(Ue,["prevent"]),title:"展开功能面板（可拖动）"},[...e[39]||(e[39]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),t("line",{x1:"9",y1:"3",x2:"9",y2:"21"}),t("line",{x1:"3",y1:"9",x2:"21",y2:"9"})],-1)])],36)),c(Je,{name:"panel-slide"},{default:f(()=>[v.value?(i(),r("div",{key:0,class:"side-panel floating-panel",style:$e({bottom:d.value.bottom+"px",right:d.value.right+"px",width:s.value.width+"px",height:s.value.height+"px"})},[t("div",{class:"panel-title-bar",onMousedown:Ne},[e[41]||(e[41]=t("span",{class:"panel-title-text"},"功能面板",-1)),t("button",{class:"panel-close-btn",onClick:e[9]||(e[9]=l=>v.value=!1),title:"收起"},[...e[40]||(e[40]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])],32),t("div",{class:"resize-handle resize-handle-right",onMousedown:e[10]||(e[10]=F(l=>ae("right",l),["stop"]))},null,32),t("div",{class:"resize-handle resize-handle-bottom",onMousedown:e[11]||(e[11]=F(l=>ae("bottom",l),["stop"]))},null,32),t("div",{class:"resize-handle resize-handle-corner",onMousedown:e[12]||(e[12]=F(l=>ae("corner",l),["stop"]))},null,32),t("div",mn,[t("button",{class:z(["tab-btn",{active:u.value==="files"}]),onClick:e[13]||(e[13]=l=>u.value="files")},[...e[42]||(e[42]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"})],-1),t("span",{class:"tab-text"},"文件",-1)])],2),t("button",{class:z(["tab-btn",{active:u.value==="documents"}]),onClick:e[14]||(e[14]=l=>u.value="documents")},[...e[43]||(e[43]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),t("polyline",{points:"14 2 14 8 20 8"}),t("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),t("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),t("polyline",{points:"10 9 9 9 8 9"})],-1),t("span",{class:"tab-text"},"文档",-1)])],2),t("button",{class:z(["tab-btn",{active:u.value==="chat"}]),onClick:e[15]||(e[15]=l=>u.value="chat")},[...e[44]||(e[44]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})],-1),t("span",{class:"tab-text"},"群聊",-1)])],2),t("button",{class:z(["tab-btn",{active:u.value==="ddl"}]),onClick:e[16]||(e[16]=l=>u.value="ddl")},[...e[45]||(e[45]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("polyline",{points:"12 6 12 12 16 14"})],-1),t("span",{class:"tab-text"},"DDL",-1)])],2)]),u.value==="files"?(i(),r("div",pn,[t("div",{class:"panel-header"},[e[47]||(e[47]=t("h3",null,"共同云盘",-1)),t("button",{class:"upload-file-btn",onClick:Le},[...e[46]||(e[46]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"17 8 12 3 7 8"}),t("line",{x1:"12",y1:"3",x2:"12",y2:"15"})],-1),E(" 上传文件 ",-1)])])]),t("input",{ref_key:"fileInput",ref:ge,type:"file",multiple:"",style:{display:"none"},onChange:Be},null,544),t("div",wn,[(i(!0),r(V,null,P(N.value,l=>(i(),R(vt,{key:l.id,file:l,onDownload:Ie,onDelete:Ee},null,8,["file"]))),128)),N.value.length===0?(i(),r("div",gn,[...e[48]||(e[48]=[t("p",null,"还没有文件，上传一个吧！",-1)])])):M("",!0)])])):M("",!0),u.value==="documents"?(i(),r("div",hn,[t("div",fn,[e[50]||(e[50]=t("h3",null,"共享文档",-1)),t("button",{class:"create-doc-btn",onClick:e[17]||(e[17]=l=>G.value=!0)},[...e[49]||(e[49]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),E(" 新建文档 ",-1)])])]),t("div",kn,[(i(!0),r(V,null,P(Y.value,l=>(i(),R(kt,{key:l.id,document:l,onOpen:Te,onDelete:Fe},null,8,["document"]))),128)),Y.value.length===0?(i(),r("div",yn,[...e[51]||(e[51]=[t("p",null,"还没有文档，创建一个吧！",-1)])])):M("",!0)])])):M("",!0),u.value==="chat"?(i(),r("div",xn,[e[52]||(e[52]=t("div",{class:"panel-header"},[t("h3",null,"群聊")],-1)),c(zt,{"chat-id":g.value},null,8,["chat-id"])])):M("",!0),u.value==="ddl"?(i(),r("div",Dn,[t("div",bn,[e[54]||(e[54]=t("h3",null,"DDL管理",-1)),t("button",{class:"add-ddl-btn",onClick:e[18]||(e[18]=l=>q.value=!0)},[...e[53]||(e[53]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),E(" 添加DDL ",-1)])])]),t("div",$n,[(i(!0),r(V,null,P(H.value,l=>(i(),R(qt,{key:l.id,ddl:l,onEdit:Oe,onDelete:He},null,8,["ddl"]))),128)),H.value.length===0?(i(),r("div",Mn,[...e[55]||(e[55]=[t("p",null,"还没有DDL，添加一个吧！",-1)])])):M("",!0)])])):M("",!0)],4)):M("",!0)]),_:1})]),c(ue,{open:j.value,"onUpdate:open":e[24]||(e[24]=l=>j.value=l),title:O.value?"编辑任务":"添加任务",width:600,onOk:Se,onCancel:he},{default:f(()=>[c(W,{model:x.value,"label-col":{span:6},"wrapper-col":{span:18}},{default:f(()=>[c(w,{label:"任务标题",required:""},{default:f(()=>[c(L,{value:x.value.title,"onUpdate:value":e[19]||(e[19]=l=>x.value.title=l),placeholder:"请输入任务标题"},null,8,["value"])]),_:1}),c(w,{label:"任务描述"},{default:f(()=>[c(I,{value:x.value.description,"onUpdate:value":e[20]||(e[20]=l=>x.value.description=l),placeholder:"请输入任务描述",rows:4},null,8,["value"])]),_:1}),c(w,{label:"负责人"},{default:f(()=>[c(L,{value:x.value.assignee,"onUpdate:value":e[21]||(e[21]=l=>x.value.assignee=l),placeholder:"请输入负责人"},null,8,["value"])]),_:1}),c(w,{label:"优先级"},{default:f(()=>[c(T,{value:x.value.priority,"onUpdate:value":e[22]||(e[22]=l=>x.value.priority=l),placeholder:"选择优先级"},{default:f(()=>[c(B,{value:"low"},{default:f(()=>[...e[56]||(e[56]=[E("低",-1)])]),_:1}),c(B,{value:"medium"},{default:f(()=>[...e[57]||(e[57]=[E("中",-1)])]),_:1}),c(B,{value:"high"},{default:f(()=>[...e[58]||(e[58]=[E("高",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),c(w,{label:"DDL"},{default:f(()=>[c(ee,{value:x.value.deadline,"onUpdate:value":e[23]||(e[23]=l=>x.value.deadline=l),"show-time":"",format:"YYYY-MM-DD HH:mm",placeholder:"选择截止时间",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"]),c(ue,{open:G.value,"onUpdate:open":e[27]||(e[27]=l=>G.value=l),title:"创建共享文档",width:600,onOk:je,onCancel:ke},{default:f(()=>[c(W,{model:A.value,"label-col":{span:6},"wrapper-col":{span:18}},{default:f(()=>[c(w,{label:"文档标题",required:""},{default:f(()=>[c(L,{value:A.value.title,"onUpdate:value":e[25]||(e[25]=l=>A.value.title=l),placeholder:"请输入文档标题"},null,8,["value"])]),_:1}),c(w,{label:"文档描述"},{default:f(()=>[c(I,{value:A.value.description,"onUpdate:value":e[26]||(e[26]=l=>A.value.description=l),placeholder:"请输入文档描述",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),c(ue,{open:q.value,"onUpdate:open":e[32]||(e[32]=l=>q.value=l),title:"添加DDL",width:600,onOk:ze,onCancel:fe},{default:f(()=>[c(W,{model:C.value,"label-col":{span:6},"wrapper-col":{span:18}},{default:f(()=>[c(w,{label:"DDL标题",required:""},{default:f(()=>[c(L,{value:C.value.title,"onUpdate:value":e[28]||(e[28]=l=>C.value.title=l),placeholder:"请输入DDL标题"},null,8,["value"])]),_:1}),c(w,{label:"截止时间",required:""},{default:f(()=>[c(ee,{value:C.value.deadline,"onUpdate:value":e[29]||(e[29]=l=>C.value.deadline=l),"show-time":"",format:"YYYY-MM-DD HH:mm",placeholder:"选择截止时间",style:{width:"100%"}},null,8,["value"])]),_:1}),c(w,{label:"描述"},{default:f(()=>[c(I,{value:C.value.description,"onUpdate:value":e[30]||(e[30]=l=>C.value.description=l),placeholder:"请输入描述",rows:3},null,8,["value"])]),_:1}),c(w,{label:"优先级"},{default:f(()=>[c(T,{value:C.value.priority,"onUpdate:value":e[31]||(e[31]=l=>C.value.priority=l),placeholder:"选择优先级"},{default:f(()=>[c(B,{value:"low"},{default:f(()=>[...e[59]||(e[59]=[E("低",-1)])]),_:1}),c(B,{value:"medium"},{default:f(()=>[...e[60]||(e[60]=[E("中",-1)])]),_:1}),c(B,{value:"high"},{default:f(()=>[...e[61]||(e[61]=[E("高",-1)])]),_:1}),c(B,{value:"urgent"},{default:f(()=>[...e[62]||(e[62]=[E("紧急",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])])}}},Bn=X(Cn,[["__scopeId","data-v-62613c4d"]]);export{Bn as default};
