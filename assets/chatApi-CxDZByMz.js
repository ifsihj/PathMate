const n=e=>new Promise(t=>setTimeout(t,e)),g=async()=>{await n(300);const e=localStorage.getItem("chat-list");return e?JSON.parse(e):[]},l=async e=>{await n(200);const t=localStorage.getItem(`chat-messages-${e}`);return t?JSON.parse(t):[]},d=async(e,t)=>{await n(300);const s={id:Date.now(),chatId:e,senderId:"current-user",senderName:"我",content:t,timestamp:Date.now(),type:"text"},a=await l(e);return a.push(s),localStorage.setItem(`chat-messages-${e}`,JSON.stringify(a)),s},w=async(e,t,s,a)=>{await n(300);const o=await g(),m=o.find(i=>i.targetUserId===e);if(m)return m;const r=`chat-${e}-${Date.now()}`,c={id:r,targetUserId:e,targetUserName:t,targetUserAvatar:s,context:a,lastMessage:null,lastMessageTime:Date.now(),unreadCount:0,createdAt:Date.now()};if(o.unshift(c),localStorage.setItem("chat-list",JSON.stringify(o)),!localStorage.getItem(`chat-messages-${r}`)){const i=[{id:Date.now()-36e5,chatId:r,senderId:e,senderName:t,content:"你好！",timestamp:Date.now()-36e5,type:"text"}];localStorage.setItem(`chat-messages-${r}`,JSON.stringify(i)),c.lastMessage="你好！"}return c},p=async e=>{await n(200);const t=await g(),s=t.find(a=>a.id===e);return s&&(s.unreadCount=0,localStorage.setItem("chat-list",JSON.stringify(t))),s},S=async e=>{await n(200);const s=(await g()).filter(a=>a.id!==e);return localStorage.setItem("chat-list",JSON.stringify(s)),localStorage.removeItem(`chat-messages-${e}`),{success:!0}},y=async(e,t)=>{await n(300);const s={id:Date.now(),chatId:e,senderId:"current-user",senderName:"我",senderAvatar:null,content:t,timestamp:Date.now(),type:"text"},a=await u(e);return a.push(s),localStorage.setItem(`group-messages-${e}`,JSON.stringify(a)),s},u=async e=>{await n(200);const t=localStorage.getItem(`group-messages-${e}`);if(t)return JSON.parse(t);const s=[{id:Date.now()-36e5,chatId:e,senderId:"user-1",senderName:"小明",senderAvatar:"/src/assets/images/avatar1.webp",content:"大家好！",timestamp:Date.now()-36e5,type:"text"},{id:Date.now()-18e5,chatId:e,senderId:"user-2",senderName:"小红",senderAvatar:"/src/assets/images/avatar2.webp",content:"欢迎加入！",timestamp:Date.now()-18e5,type:"text"}];return localStorage.setItem(`group-messages-${e}`,JSON.stringify(s)),s};export{l as a,d as b,w as c,g as d,S as e,u as g,p as m,y as s};
