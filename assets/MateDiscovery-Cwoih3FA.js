import{_ as K,r as m,j as R,y as z,b as A,c as r,a,m as b,d as l,t as C,w as i,e as d,F as M,f as L,i as E,k as T,u as W,o as n,h as F,p as I,v}from"./index-kcQoswnZ.js";import{D as B}from"./DiscoveryCard-DAYZeJFw.js";const $={class:"mate-discovery"},G={class:"upload-section"},H={key:0,class:"search-result-header"},P={class:"search-info"},Q={class:"search-keyword"},X={class:"result-count"},Y={key:1,class:"content-feed"},Z={key:2,class:"no-results"},ee={class:"no-results-content"},te={key:3,class:"content-feed"},oe={key:0},ae={__name:"MateDiscovery",setup(se){const S=W(),h=T(),p=m(!1),t=m({title:"",content:"",coverFileList:[]}),c=m([]),U=s=>s.type.startsWith("image/")?(s.size/1024/1024<2||v.error("图片大小不能超过 2MB!"),!1):(v.error("只能上传图片文件!"),!1),D=()=>{if(!t.value.title.trim()){v.warning("请输入标题");return}if(!t.value.content.trim()){v.warning("请输入内容描述");return}const s={id:Date.now(),title:t.value.title,author:"当前用户",authorAvatar:null,coverImage:t.value.coverFileList[0]?.thumbUrl||null,content:t.value.content};c.value.unshift(s),v.success("发布成功!"),w(),p.value=!1,N()},w=()=>{t.value={title:"",content:"",coverFileList:[]}},k=s=>{console.log("点击了卡片:",s)},u=m(""),g=()=>{u.value=h.query.search||""},f=R(()=>{if(!u.value)return c.value;const s=u.value.toLowerCase().trim();return c.value.filter(e=>e.title.toLowerCase().includes(s))}),x=()=>{S.push({name:"discovery-mate"}),u.value=""},N=()=>{localStorage.setItem("discovery-mate-items",JSON.stringify(c.value))};return z(()=>h.query.search,()=>{g()},{immediate:!0}),A(()=>{const s=localStorage.getItem("discovery-mate-items");if(s)try{const e=JSON.parse(s);c.value=e}catch(e){console.error("Failed to load mate items:",e)}g()}),(s,e)=>{const _=d("a-button"),V=d("a-input"),y=d("a-form-item"),j=d("a-upload"),q=d("a-textarea"),O=d("a-form"),J=d("a-modal");return n(),r("div",$,[a("div",G,[a("button",{class:"upload-btn",onClick:e[0]||(e[0]=o=>p.value=!0)},[...e[5]||(e[5]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[a("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),a("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),a("span",null,"发布 Mate",-1)])])]),u.value?(n(),r("div",H,[a("div",P,[a("span",Q,'搜索关键词: "'+C(u.value)+'"',1),a("span",X,"找到 "+C(f.value.length)+" 个 Mate",1)]),l(_,{type:"link",onClick:x},{default:i(()=>[...e[6]||(e[6]=[F("清除搜索",-1)])]),_:1})])):b("",!0),f.value.length>0?(n(),r("div",Y,[(n(!0),r(M,null,L(f.value,o=>(n(),I(B,{key:o.id,item:o,onClick:k},null,8,["item"]))),128))])):u.value?(n(),r("div",Z,[a("div",ee,[e[8]||(e[8]=E('<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-0fd5dbe5><circle cx="11" cy="11" r="8" data-v-0fd5dbe5></circle><line x1="21" y1="21" x2="16.65" y2="16.65" data-v-0fd5dbe5></line></svg><p class="no-results-text" data-v-0fd5dbe5>未找到相关 Mate</p><p class="no-results-hint" data-v-0fd5dbe5>尝试使用其他关键词搜索</p>',3)),l(_,{type:"primary",onClick:x},{default:i(()=>[...e[7]||(e[7]=[F("清除搜索",-1)])]),_:1})])])):(n(),r("div",te,[(n(!0),r(M,null,L(c.value,o=>(n(),I(B,{key:o.id,item:o,onClick:k},null,8,["item"]))),128))])),l(J,{open:p.value,"onUpdate:open":e[4]||(e[4]=o=>p.value=o),title:"发布新的 Mate",width:600,onOk:D,onCancel:w},{default:i(()=>[l(O,{model:t.value,"label-col":{span:6},"wrapper-col":{span:18}},{default:i(()=>[l(y,{label:"标题",required:""},{default:i(()=>[l(V,{value:t.value.title,"onUpdate:value":e[1]||(e[1]=o=>t.value.title=o),placeholder:"请输入 Mate 标题",maxlength:50,"show-count":""},null,8,["value"])]),_:1}),l(y,{label:"封面图"},{default:i(()=>[l(j,{"file-list":t.value.coverFileList,"onUpdate:fileList":e[2]||(e[2]=o=>t.value.coverFileList=o),"list-type":"picture-card","before-upload":U},{default:i(()=>[t.value.coverFileList.length<1?(n(),r("div",oe,[...e[9]||(e[9]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[a("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),a("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),a("div",{style:{"margin-top":"8px"}},"上传封面",-1)])])):b("",!0)]),_:1},8,["file-list"])]),_:1}),l(y,{label:"内容描述",required:""},{default:i(()=>[l(q,{value:t.value.content,"onUpdate:value":e[3]||(e[3]=o=>t.value.content=o),placeholder:"请输入 Mate 的详细描述...",rows:6,maxlength:1e3,"show-count":""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])])}}},re=K(ae,[["__scopeId","data-v-0fd5dbe5"]]);export{re as default};
